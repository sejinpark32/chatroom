<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/bootstrap.css"/>
    <link rel="stylesheet" href="/css/chat.css"/>
</head>
<body>
<form class="container">
    <div id="wrap" class="row">
        <div class="col-4">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a href="javascript:;" class="nav-link active">방리스트</a></li>
                <li class="nav-item"><a href="javascript:;" class="nav-link">접속자리스트</a></li>
            </ul>
            <div>
                <ul id="room-list" class="list-group list-group-flush"></ul>
                <ul id="user-list" class="list-group list-group-flush"></ul>
            </div>
        </div>
        <div class="col-8">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a href="javascript:;" class="nav-link active">대기방</a></li>
            </ul>
            <div  id="rooms">
                <div id="waiting"></div>
            </div>
            <div>
                <input type="text" id="m"/>
                <button type="submit">전송</button>
            </div>
        </div>
    </div>
</form>
<script src="/js/socket.io/client-dist/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
    $(function(){
        const $wrap = $('#wrap');
        const $roomList = $('#room-list');
        const $userList = $('#user-list');
        const $roomArea = $('#rooms');
        const socket = io();
        let roomId = 'waiting';
        const roomDivs = {'waiting' : $roomArea.find('#waiting')}; //id:노드

        $('form').submit(function(e){
           e.preventDefault();
           socket.emit('chat message', {
               message:$('#m').val(),
               roomId:roomId
           });
            $('#m').val('');
            return false;
        });

        socket.on('message', (data)=> {
            let sendType = data.sendType;

            switch (sendType) {
                case "wait":
                    let roomInfo = data.roomInfo;
                    let userInfo = data.userInfo;

                    roomInfo.forEach((room) => {
                        $roomList.append('<li class="list-group-item"><a href="javascript:;" data-id="'+room.id+'">'+ room.id +'(' + room.userSize + ')</a></li>');
                    });

                    userInfo.forEach((user) => {
                        $userList.append('<li class="list-group-item"><a href="javascript:;" data-id="' + user.userId +'">' + user.nickName + '</a></li>');
                    });

                    break;
                case "leave":
                    let roomId = data.roomId;
                    let message = data.message;
                    break;
                case "enter":
                    break;
                default:

            }

        });
    });

</script>
</body>
</html>